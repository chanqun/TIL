# 데이터 중심 애플리케이션 설계 - 신뢰할 수 있고 확장 가능하며 유지보수하기 쉬운 시스템을 지탱하는 핵심 아이디어

1부 데이터 중심 애플리케이션 설계 근본 개념
2부 한 장비에서 여러 장비로 분산 저장
3부 데이터셋에서 데이터셋을 파생하는 시스템

## Part 1. 데이터 시스템의 기초

### 1장 신뢰할 수 있고 확장 가능하며 유지보수하기 쉬운 애플리케이션

오늘날 많은 애플리케이션은 계산 중심과는 다르게 데이터 중심적

일반적으로 데이터 중심 애플리케이션은 공통으로 필요로 하는 기능을 제공하는 표준 구성 요소로 만듬
- 데이터베이스
- 캐시
- 검색 색인
- 스트림 처리 - 비동기 처리를 위해 다른 프로세스로 메시지 보내기
- 일괄처리


#### 신뢰성
무언가 잘못되더라도 지속적을 올바르게 동작함
결함을 예측하고 대응할 수 있는 시스템 (결함성 또는 탄력성 - 넷플릭스 카오스 몽키)
    - 하드웨어 오류
    - 소프트웨어 오류
    - 인적 오류 (오류의 가능성을 최소화하는 인터페이스, 오류용 샌드박스 제공, 테스트하라, 롤백을 빠르게, 모니터링, 교육)

트위터 트윗작성 및 홈 타임라인 - 트위터의 확장성 문제는 주로 트윗 양이 아닌 팬 아웃
1. 트윗 작성은 간단히 새로운 트윗을 트윗 전역에 삽입, 홈 타임라인 요청하는 경우 팔로우하는 모든 사람 찾고, 시간 순으로 정렬
2. 각 수신 사용자용 트윗 우편함처럼 개별 사용자의 홈 타임라인 캐시를 유지 트윗을 작성하면 해당 사용자를 팔로우하는 사람에게 새로운 트윗을 삽입

왜? 트윗 게시 요청량이 홈 타임라인 읽기 요청량에 비해 수백 배 적기 떄문에
(하지만 팔로워가 3천만 명 넘는 사람은 단일 트윗이 3천만 건 이상의 쓰기 요청이 될 수 있음)

-> 혼합형을 사용한다. 팔로워 수가 많은 사람은 1번 방식 

#### 확장성

성능 기술 - 특이값, 산술평균, 중앙값
부하 대응 접근 방식 - scaling up, scaling out

#### 유지보수성
유지보수성 (운용성, 단순성, 발전성)

### 2장 데이터 모델과 질의 언어

데이터 모델은 소프트웨어가 어떻게 작성됐는지 뿐만 아니라 해결하려는 문제를 어떻게 생각해야 하는지에 대해서도 지대한 영향을 미친다.

#### 관계형 모델과 문서 모델
관계형 데이터베이스의 근원은 비즈니스 데이터 처리 - 트랜잭션 처리와 일괄 처리

#### NoSQL의 탄생
- 대규모 데이터셋이나 매우 높은 쓰기 처리량 달성을 관계형 데이터베이스보다 쉽게 할 수 있는 확장성 필요
- 무료 오픈소스 소프트웨어 선호도 확산
- 관계형 모델에서 지원하지 않는 특수 질의
- 동적이고 표현력 풍부한 모델

#### 객체 관계형 불일치
데이터를 관계형 테이블에 저장하려면 애플리케이션 코드와 데이터 베이스 모델 객체 사이의 전환 계층이 필요 (임피던스 불일치)

이력서 같은 데이터 구조는 모든 내용을 갖추고 있는 문서라서 json으로 적합

다대다 처리가 어려울 때 -> 관계형 모델, 네트워크 모델(타고 찾아야함 포인터 같음) 해결법이 있었음

다대일과 다대다 관계를 표현할 떄 관계형 데이터베이스와 문서 데이터베이스는 근본적으로 다르지 않다 (외래 키, 문서 참조)

- 다른 여러 유형의 오브젝트가 있고 각 유형의 오브젝트별로 자체 테이블에 넣는 방법은 실용적이지 않음
- 사용자가 제어할 수 없고 언제나 변경 가능한 외부 시스템에 의해 데이터 구조가 결정되는 경우
이런 경우 스키마는 득보다 실이 많음 

#### 데이터를 위한 질의 언어
sql은 선언형, ims와 코다실은 명령형

#### 맵리듀스 질의
맵리듀스는 선언형 질의와 명령형 질의 중간 정도,

#### 그래프형 데이터 모델
소셜 그래프, 웹 그래프, 도로나 철도 네트워크

#### 속성 그래프
각 정점은
- 고유한 식별자
- 유출 간선 집합
- 유입 간선 집합
- 속성 컬렉션
각 간선은
- 고유한 식별자
- 꼬리 정점
- 머리 정점
- 정점 간 관계 유형 설명하는 레이블
- 속성 컬렉션
을 가짐

#### 사이퍼 질의 언어
속성 그래프를 위한 선언형 질의 언어

#### 트리플 저장소와 스파클, 시맨틱 웹, RDF 데이터 모델, 스파클 질의 언어,

### 3장 저장소와 검색

가장 기본적인 수준에서 데이터베이스는 두 가지 작업을 수행한다. 어떤 데이터를 받음녀 데이터를 저장하고 나중에 그 데이터를 요청하면 다시 데이터를 제공한다.

애플리케이션 개발자가 주의해야 하는 이유는 특정장업부하 유형에서 좋은 성능을 내게끔 저장소 엔진을 조정하기 위해서이다.
(로그 구조(log-structured) 계열 저장소 엔진과 페이지 지향 계열 저장소 엔진을 검토)

색인을 잘 선택했다면 읽기 질의 속도가 향상된다. 하지만 모든 색인은 쓰기 속도를 떨어뜨린다. (저장소 시스템에서 중요한 트레이드오프)

#### 해시 색인
키-값 사전 타입과 매우 유사
세그먼트 나누고 컴팩션 잘해야함

실제 구현에서 중요한 문제
- 파일 형식, 레코드 삭제, 고장 복구, 부분적으로 레코드 쓰기, 동시성 제어
  (키가 너무 많으면 문제가 된다, 해쉬 테이블은 범위 질의에 효율적이지 않다)

##### SS 테이블과 LSM 트리
##### B트리와 LSM 트리

#### 트랜잭션 처리나 분석
OLTP (online transaction processing), OLAP(online analytic processing)

데이터 웨어하우스는 분석가들이 OLTP 작업에 영향을 주지 않고 마음껏 질의할 수 있는 개별 데이터베이스다.

#### 분석용 스키마 : 별 모양 스키마와 눈꽃송이 모양 스키마
별 모양 스키마란 이름은 테이 이름은 테이블 관계가 시각화될 떄 사실 테이블이 가운데에 있고 차원 테이블로 둘러싸고 있다는 사실에서 비롯됐다.
눈꽃송이 모양 스키마라고 하며 차원이 하위차원으로 더 세분화된다.

