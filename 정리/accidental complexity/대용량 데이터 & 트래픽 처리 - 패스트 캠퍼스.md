
## Part 3 고성 서비스를 위한 Redis 활용 및 아키텍처

- Redis가 무엇인지 특성 중심으로 설명할 수 있게 된다.
- 세션 스토어, 캐시와 같은 Redis의 주요한 활용 방법을 익히고 구현할 수 있게 된다.
- 클러스터 구성, 백업과 장애 복구 등 실제 Redis 운영에 필요한 지식을 갖춘다.
- Redis를 활용하는 다양한 애플리케이션 아키텍처들을 익힌다.


### Redis의 정의
- Remote Dictionary Server
- Storage: 데이터 저장소
- Database: 전통적인 DBMS의 역할을 수행 (영속성 관점)
- Middleware: 애플리케이션이 이용할 수 있는 유용한 기능을 제공하는 소프트웨어

### Redis로 할 수 있는 것?
- 아주 빠른 데이터 저장소로 활용
- 분산된 서버들간의 커뮤니케이션(동기화, 작업 분할 등), 세션
- 내장된 자료구조를 활용한 기능 구현, sorted set (ranking), pubsub, stream

In-memory DB
- 데이터를 디스크에 저장하지 않음
- 휘발성인 RAM에 저장
- 빠른 속도

HDD -> SSD(3HDD) -> RAM(40SSD)

빠른 속도와 휘발성의 절충
- 용도에 맞게 DB와 Redis 사용
- 혼합해서 사용(Cache)
- Redis의 영속성 확보(백업 등)

DB(영속성 데이터), Redis(단기 사용 데이터) 나눔

### Key-value store로서의 Redis

데이터 저장소의 구조
- 프로그램 언어에서의 데이터 구조 (Array, List, Map)
- DB의 데이터 모델 관점에서의 구조 (네트워크 모델, 계층형 모델(Tree), 관계형 모델)

key-value store?
- 특정 값을 key로 해서 그와 연관된 데이터를 value로 저장(Map과 같음)
- 가장 단순한 데이터 저장 방식
- 단순한 만큼 빠르고 성능이 좋음

장점
- 단순성에서 오는 쉬운 구현과 사용성
- Hash를 이용해 값을 바로 읽으므로 속도가 빠름(추가 연산이 필요 없음)
- 분산 환경에서의 수평적 확작성
단점
- Key를 통해서만 값을 읽을 수 있음
- 범위 검색 등의 복잡한 질의가 불가능

활용
- 언어의 자료구조(Java의 HashMap)
- NoSQL DB(Redis, Riak, AWS DynamoDB)
- 단순한 구조의 데이터로 높은 성능과 확장성이 필요할 때 사용

### Redis의 등장과 활용
- 서버를 개발하며 Redis를 사용하지 않는 기업을 찾기가 어려움
- Session Store
- Cache
- Limit Rater (분당 호출 수 제한)
- Job queue
-> 별도로 구현해야 했던 공통적인 기능들을 Redis를 사용하면 쉽게 구현 가능하다.

### 관계형 DB의 이해
관계형 DB(관계형 데이터 모델 사용)
NoSQL(다른 데이터 모델 사용)

장점
- 데이터 무결성을 유지에 용이함(정규화를 통해 중복을 제거)
- SQL을 통해 복잡한 질의를 수행 가능
단점
- 고정된 스키마를 정의해야 함
- Join으로 인한 성능 문제
- 데이터들이 복잡한 관계를 맺고 있기 때문에 수평적 확장성이 떨어짐

NoSQL이란?
- Not Only SQL 또는 No SQL
- 관계형 DB에서 사용하는 SQL을 사용하지 않는다는 의미
- 비 관계형 데이터베이스를 지칭할 때 사용

개발 환경의 변화
- 스토리지 비용이 내려감(데이터 중복이 스토리지 용량 면에서는 큰 이슈가 아니게 됨)
- 다루는 데이터의 크기와 성능 요구사항이 커짐(고성능 데이터 모델이나 데이터 분할이 필요)
- 분산 환경의 대중화
- 단순한 대량의 데이터가 다루기 쉽다

종류
Key-value : Redis, Memcached, Riak, DynamoDB
Document: MongoDB, CouchDB
Wide Column: Cassandra, HBase, Google BigTable
Graph: Neo4J, OrientDB, AgensGraph

Redis는 DBMS인가?
- 데이터를 다루는 인터페이스를 제공하므로 DBMS의 성격이 있음
- 기본적으로 영속성을 위한 DB는 아님
- 영속성을 지원(백업)
- DBMS보다는 빠른 캐시의 성격으로 대표됨

특성
- 다양한 자료구조를 지원
- 기본적으로 NoSQL DB로 분류되는 key-value store

External Heap로서의 Redis
- Application이 장애가 나도 Redis의 데이터는 보존(단기)
- Application이 여러 머신에서 돌아도 같은 데이터를 접근 가능

Middleware로서의 Redis
- Redis가 제공하는 자료구조를 활용해 복잡한 로직을 쉽게 구현

명령어
```
redis-cli
set key banana
get key
keys * (위험)
dbsize
flushall
```

### Redis Data Type의 이해
- Strings
  - binary-safe, 바이너리로 변환할 수 있는 모든 데이터를 저장 가능(JPG와 같은 파일 등)
  - incr mycount, decr mycount (Integer 취급 1 증가, 감소) atomic 함 (게시글 좋아요) : 중복 누락 없음
  - MSET 여러 키에 대한 값을 한번에 저장한다, MGET

- Lists
  - Linked-list 형태의 자료구조(인덱스 접근은 느리지만 데이터 추가/삭제가 빠름)
  - Queue와 Stack으로 사용할 수 있음
  - LPUSH, RPUSH, LPOP, RPOP, LRANGE (LRANGE mylist 0 -1), LLEN

- Sets
  - 순서가 없는 유니크한 값의 집합 : 쿠폰 발급 받았는지 안 받았는지 (set에 id)
  - 검색이 빠름
  - 개별 접근을 위한 인덱스가 존재하지 않고, 집합 연산이 가능 (교집합, 합집합)
  - SADD, SREM, SCARD(count), SMEMBERS, SISMEMBER

